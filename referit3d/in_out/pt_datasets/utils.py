import warnings
import numpy as np
import multiprocessing as mp
from torch.utils.data import DataLoader


def max_io_workers():
    """ number of available cores -1."""
    n = max(mp.cpu_count() - 1, 1)
    print('Using {} cores for I/O.'.format(n))
    return n


def dataset_to_dataloader(dataset, split, batch_size, n_workers, pin_memory=False, seed=None):
    """
    :param dataset:
    :param split:
    :param batch_size:
    :param n_workers:
    :param pin_memory:
    :param seed:
    :return:
    """
    batch_size_multiplier = 1 if split == 'train' else 2
    b_size = int(batch_size_multiplier * batch_size)

    drop_last = False
    if split == 'train' and len(dataset) % b_size == 1:
        print('dropping last batch during training')
        drop_last = True

    shuffle = split == 'train'

    worker_init_fn = lambda x: np.random.seed(seed)
    if split == 'test':
        if type(seed) is not int:
            warnings.warn('Test split is not seeded in a deterministic manner.')

    data_loader = DataLoader(dataset,
                             batch_size=b_size,
                             num_workers=n_workers,
                             shuffle=shuffle,
                             drop_last=drop_last,
                             pin_memory=pin_memory,
                             worker_init_fn=worker_init_fn)
    return data_loader


def sample_scan_object(object, n_points):
    sample = object.sample(n_samples=n_points)
    return np.concatenate([sample['xyz'], sample['color']], axis=1)


def pad_samples(samples, max_context_size, padding_value=1):
    n_pad = max_context_size - len(samples)

    if n_pad > 0:
        shape = (max_context_size, samples.shape[1], samples.shape[2])
        temp = np.zeros(shape, dtype=samples.dtype) * padding_value
        temp[:samples.shape[0], :samples.shape[1]] = samples
        samples = temp

    return samples


def check_segmented_object_order(scans):
    """ check all scan objects have the three_d_objects sorted by id
    :param scans: (dict)
    """
    for scan_id, scan in scans.items():
        idx = scan.three_d_objects[0].object_id
        for o in scan.three_d_objects:
            if not (o.object_id == idx):
                print('Check failed for {}'.format(scan_id))
                return False
            idx += 1
    return True


def objects_bboxes(context):
    b_boxes = []
    for o in context:
        bbox = o.get_bbox(axis_aligned=True)

        # Get the centre
        cx, cy, cz = bbox.cx, bbox.cy, bbox.cz

        # Get the scale
        lx, ly, lz = bbox.lx, bbox.ly, bbox.lz

        b_boxes.append([cx, cy, cz, lx, ly, lz])

    return np.array(b_boxes).reshape((len(context), 6))


def instance_labels_of_context(context, max_context_size, label_to_idx=None, add_padding=True):
    """
    :param context: a list of the objects
    :return:
    """
    ori_instance_labels = [i.instance_label for i in context]

    if add_padding:
        n_pad = max_context_size - len(context)
        ori_instance_labels.extend(['pad'] * n_pad)

    if label_to_idx is not None:
        instance_labels = np.array([label_to_idx[x] for x in ori_instance_labels])

    return instance_labels


def mean_rgb_unit_norm_transform(segmented_objects, mean_rgb, unit_norm, epsilon_dist=10e-6, inplace=True):
    """
    :param segmented_objects: K x n_points x 6, K point-clouds with color.
    :param mean_rgb:
    :param unit_norm:
    :param epsilon_dist: if max-dist is less than this, we apply not scaling in unit-sphere.
    :param inplace: it False, the transformation is applied in a copy of the segmented_objects.
    :return:
    """
    if not inplace:
        segmented_objects = segmented_objects.copy()

    # adjust rgb
    segmented_objects[:, :, 3:6] -= np.expand_dims(mean_rgb, 0)

    # center xyz
    if unit_norm:
        xyz = segmented_objects[:, :, :3]
        mean_center = xyz.mean(axis=1)
        xyz -= np.expand_dims(mean_center, 1)
        max_dist = np.max(np.sqrt(np.sum(xyz ** 2, axis=-1)), -1)
        max_dist[max_dist < epsilon_dist] = 1  # take care of tiny point-clouds, i.e., padding
        xyz /= np.expand_dims(np.expand_dims(max_dist, -1), -1)
        segmented_objects[:, :, :3] = xyz

    return segmented_objects

# ------------------------------------------------------------------------
# BEAUTY DETR
# Copyright (c) 2022 Ayush Jain & Nikolaos Gkanatsios
# Licensed under CC-BY-NC [see LICENSE for details]
# All Rights Reserved
# ------------------------------------------------------------------------
# Parts adapted from Group-Free
# Copyright (c) 2021 Ze Liu. All Rights Reserved.
# Licensed under the MIT License.
# ------------------------------------------------------------------------

class ScannetDatasetConfig:
    def __init__(self, name='butd'):
        if name == 'butd':
            self.type2class = {'wall': 0, 'chair': 1, 'floor': 2, 'table': 3, 'door': 4, 'couch': 5, 'cabinet': 6, 'shelf': 7, 'desk': 8, 'office chair': 9, 'bed': 10, 'pillow': 11, 'sink': 12, 'picture': 13, 'window': 14, 'toilet': 15, 'bookshelf': 16, 'monitor': 17, 'curtain': 18, 'book': 19, 'armchair': 20, 'coffee table': 21, 'drawer': 22, 'box': 23, 'refrigerator': 24, 'lamp': 25, 'kitchen cabinet': 26, 'towel': 27, 'clothes': 28, 'tv': 29, 'nightstand': 30, 'counter': 31, 'dresser': 32, 'stool': 33, 'couch cushions': 34, 'plant': 35, 'ceiling': 36, 'bathtub': 37, 'end table': 38, 'dining table': 39, 'keyboard': 40, 'bag': 41, 'backpack': 42, 'toilet paper': 43, 'printer': 44, 'tv stand': 45, 'whiteboard': 46, 'carpet': 47, 'blanket': 48, 'shower curtain': 49, 'trash can': 50, 'closet': 51, 'staircase': 52, 'microwave': 53, 'rug': 54, 'stove': 55, 'shoe': 56, 'computer tower': 57, 'bottle': 58, 'bin': 59, 'ottoman': 60, 'bench': 61, 'board': 62, 'washing machine': 63, 'mirror': 64, 'copier': 65, 'basket': 66, 'sofa chair': 67, 'file cabinet': 68, 'fan': 69, 'laptop': 70, 'shower': 71, 'paper': 72, 'person': 73, 'headboard': 74, 'paper towel dispenser': 75, 'faucet': 76, 'oven': 77, 'footstool': 78, 'blinds': 79, 'rack': 80, 'plate': 81, 'blackboard': 82, 'piano': 83, 'heater': 84, 'soap': 85, 'suitcase': 86, 'rail': 87, 'radiator': 88, 'recycling bin': 89, 'container': 90, 'wardrobe closet': 91, 'soap dispenser': 92, 'telephone': 93, 'bucket': 94, 'clock': 95, 'stand': 96, 'light': 97, 'laundry basket': 98, 'pipe': 99, 'round table': 100, 'clothes dryer': 101, 'coat': 102, 'guitar': 103, 'toilet paper holder': 104, 'seat': 105, 'step': 106, 'speaker': 107, 'vending machine': 108, 'column': 109, 'bicycle': 110, 'ladder': 111, 'cover': 112, 'bathroom stall': 113, 'foosball table': 114, 'shower wall': 115, 'chest': 116, 'cup': 117, 'jacket': 118, 'storage bin': 119, 'screen': 120, 'coffee maker': 121, 'hamper': 122, 'dishwasher': 123, 'paper towel roll': 124, 'machine': 125, 'mat': 126, 'windowsill': 127, 'tap': 128, 'pool table': 129, 'hand dryer': 130, 'bar': 131, 'frame': 132, 'toaster': 133, 'handrail': 134, 'bulletin board': 135, 'ironing board': 136, 'fireplace': 137, 'soap dish': 138, 'kitchen counter': 139, 'glass': 140, 'doorframe': 141, 'toilet paper dispenser': 142, 'mini fridge': 143, 'fire extinguisher': 144, 'shampoo bottle': 145, 'ball': 146, 'hat': 147, 'shower curtain rod': 148, 'toiletry': 149, 'water cooler': 150, 'desk lamp': 151, 'paper cutter': 152, 'switch': 153, 'tray': 154, 'shower door': 155, 'shirt': 156, 'pillar': 157, 'ledge': 158, 'vase': 159, 'toaster oven': 160, 'mouse': 161, 'nerf gun': 162, 'toilet seat cover dispenser': 163, 'can': 164, 'furniture': 165, 'cart': 166, 'step stool': 167, 'dispenser': 168, 'storage container': 169, 'side table': 170, 'lotion': 171, 'cooking pot': 172, 'toilet brush': 173, 'scale': 174, 'tissue box': 175, 'remote': 176, 'light switch': 177, 'crate': 178, 'ping pong table': 179, 'platform': 180, 'slipper': 181, 'power outlet': 182, 'cutting board': 183, 'controller': 184, 'decoration': 185, 'trolley': 186, 'sign': 187, 'projector': 188, 'sweater': 189, 'globe': 190, 'closet door': 191, 'plastic container': 192, 'statue': 193, 'vacuum cleaner': 194, 'wet floor sign': 195, 'candle': 196, 'easel': 197, 'wall hanging': 198, 'dumbell': 199, 'ping pong paddle': 200, 'plunger': 201, 'soap bar': 202, 'stuffed animal': 203, 'water fountain': 204, 'footrest': 205, 'headphones': 206, 'plastic bin': 207, 'coatrack': 208, 'dish rack': 209, 'broom': 210, 'guitar case': 211, 'mop': 212, 'magazine': 213, 'range hood': 214, 'scanner': 215, 'bathrobe': 216, 'futon': 217, 'dustpan': 218, 'hand towel': 219, 'organizer': 220, 'map': 221, 'helmet': 222, 'hair dryer': 223, 'exercise ball': 224, 'iron': 225, 'studio light': 226, 'cabinet door': 227, 'exercise machine': 228, 'workbench': 229, 'water bottle': 230, 'handicap bar': 231, 'tank': 232, 'purse': 233, 'vent': 234, 'piano bench': 235, 'bunk bed': 236, 'shoe rack': 237, 'shower floor': 238, 'case': 239, 'swiffer': 240, 'stapler': 241, 'cable': 242, 'garbage bag': 243, 'banister': 244, 'trunk': 245, 'tire': 246, 'folder': 247, 'car': 248, 'flower stand': 249, 'water pitcher': 250, 'loft bed': 251, 'shopping bag': 252, 'curtain rod': 253, 'alarm': 254, 'washcloth': 255, 'toolbox': 256, 'sewing machine': 257, 'mailbox': 258, 'toothpaste': 259, 'rope': 260, 'electric panel': 261, 'bowl': 262, 'boiler': 263, 'paper bag': 264, 'alarm clock': 265, 'music stand': 266, 'instrument case': 267, 'paper tray': 268, 'paper shredder': 269, 'projector screen': 270, 'boots': 271, 'kettle': 272, 'mail tray': 273, 'cat litter box': 274, 'covered box': 275, 'ceiling fan': 276, 'cardboard': 277, 'binder': 278, 'beachball': 279, 'envelope': 280, 'thermos': 281, 'breakfast bar': 282, 'dress rack': 283, 'frying pan': 284, 'divider': 285, 'rod': 286, 'magazine rack': 287, 'laundry detergent': 288, 'sofa bed': 289, 'storage shelf': 290, 'loofa': 291, 'bycicle': 292, 'file organizer': 293, 'fire hose': 294, 'media center': 295, 'umbrella': 296, 'barrier': 297, 'subwoofer': 298, 'stepladder': 299, 'shorts': 300, 'rocking chair': 301, 'elliptical machine': 302, 'coffee mug': 303, 'jar': 304, 'door wall': 305, 'traffic cone': 306, 'pants': 307, 'garage door': 308, 'teapot': 309, 'barricade': 310, 'exit sign': 311, 'canopy': 312, 'kinect': 313, 'kitchen island': 314, 'messenger bag': 315, 'buddha': 316, 'block': 317, 'stepstool': 318, 'tripod': 319, 'chandelier': 320, 'smoke detector': 321, 'baseball cap': 322, 'toothbrush': 323, 'bathroom counter': 324, 'object': 325, 'bathroom vanity': 326, 'closet wall': 327, 'laundry hamper': 328, 'bathroom stall door': 329, 'ceiling light': 330, 'trash bin': 331, 'dumbbell': 332, 'stair rail': 333, 'tube': 334, 'bathroom cabinet': 335, 'cd case': 336, 'closet rod': 337, 'coffee kettle': 338, 'wardrobe cabinet': 339, 'structure': 340, 'shower head': 341, 'keyboard piano': 342, 'case of water bottles': 343, 'coat rack': 344, 'storage organizer': 345, 'folded chair': 346, 'fire alarm': 347, 'power strip': 348, 'calendar': 349, 'poster': 350, 'potted plant': 351, 'luggage': 352, 'mattress': 353, 'hand rail': 354, 'folded table': 355, 'poster tube': 356, 'thermostat': 357, 'flip flops': 358, 'cloth': 359, 'banner': 360, 'clothes hanger': 361, 'whiteboard eraser': 362, 'shower control valve': 363, 'compost bin': 364, 'teddy bear': 365, 'pantry wall': 366, 'tupperware': 367, 'beer bottles': 368, 'salt': 369, 'mirror doors': 370, 'folded ladder': 371, 'carton': 372, 'soda stream': 373, 'metronome': 374, 'music book': 375, 'rice cooker': 376, 'dart board': 377, 'grab bar': 378, 'flowerpot': 379, 'painting': 380, 'railing': 381, 'stair': 382, 'quadcopter': 383, 'pitcher': 384, 'hanging': 385, 'mail': 386, 'closet ceiling': 387, 'hoverboard': 388, 'beanbag chair': 389, 'spray bottle': 390, 'soap bottle': 391, 'ikea bag': 392, 'duffel bag': 393, 'oven mitt': 394, 'pot': 395, 'hair brush': 396, 'tennis racket': 397, 'display case': 398, 'bananas': 399, 'carseat': 400, 'coffee box': 401, 'clothing rack': 402, 'bath walls': 403, 'podium': 404, 'storage box': 405, 'dolly': 406, 'shampoo': 407, 'changing station': 408, 'crutches': 409, 'grocery bag': 410, 'pizza box': 411, 'shaving cream': 412, 'luggage rack': 413, 'urinal': 414, 'hose': 415, 'bike pump': 416, 'bear': 417, 'humidifier': 418, 'mouthwash bottle': 419, 'golf bag': 420, 'food container': 421, 'card': 422, 'mug': 423, 'boxes of paper': 424, 'flag': 425, 'rolled poster': 426, 'wheel': 427, 'blackboard eraser': 428, 'doll': 429, 'laundry bag': 430, 'sponge': 431, 'lotion bottle': 432, 'lunch box': 433, 'sliding wood door': 434, 'briefcase': 435, 'bath products': 436, 'star': 437, 'coffee bean bag': 438, 'ipad': 439, 'display rack': 440, 'massage chair': 441, 'paper organizer': 442, 'cap': 443, 'dumbbell plates': 444, 'elevator': 445, 'cooking pan': 446, 'trash bag': 447, 'santa': 448, 'jewelry box': 449, 'boat': 450, 'sock': 451, 'plastic storage bin': 452, 'dishwashing soap bottle': 453, 'xbox controller': 454, 'airplane': 455, 'conditioner bottle': 456, 'tea kettle': 457, 'wall mounted coat rack': 458, 'film light': 459, 'sofa': 460, 'pantry shelf': 461, 'fish': 462, 'toy dinosaur': 463, 'cone': 464, 'fire sprinkler': 465, 'contact lens solution bottle': 466, 'hand sanitzer dispenser': 467, 'pen holder': 468, 'wig': 469, 'night light': 470, 'notepad': 471, 'drum set': 472, 'closet shelf': 473, 'exercise bike': 474, 'soda can': 475, 'stovetop': 476, 'telescope': 477, 'battery disposal jar': 478, 'closet floor': 479, 'clip': 480, 'display': 481, 'postcard': 482, 'paper towel': 483, 'food bag': 484}
        elif name == 'nr3d':
            self.type2class = {'air hockey table': 0, 'airplane': 1, 'alarm': 2, 'alarm clock': 3, 'armchair': 4, 'baby mobile': 5, 'backpack': 6, 'bag': 7, 'bag of coffee beans': 8, 'ball': 9, 'banana holder': 10, 'bananas': 11, 'banister': 12, 'banner': 13, 'bar': 14, 'barricade': 15, 'basket': 16, 'bath products': 17, 'bath walls': 18, 'bathrobe': 19, 'bathroom cabinet': 20, 'bathroom counter': 21, 'bathroom stall': 22, 'bathroom stall door': 23, 'bathroom vanity': 24, 'bathtub': 25, 'battery disposal jar': 26, 'beachball': 27, 'beanbag chair': 28, 'bear': 29, 'bed': 30, 'beer bottles': 31, 'bench': 32, 'bicycle': 33, 'bike lock': 34, 'bike pump': 35, 'bin': 36, 'blackboard': 37, 'blanket': 38, 'blinds': 39, 'block': 40, 'board': 41, 'boards': 42, 'boat': 43, 'boiler': 44, 'book': 45, 'book rack': 46, 'books': 47, 'bookshelf': 48, 'bookshelves': 49, 'boots': 50, 'bottle': 51, 'bowl': 52, 'box': 53, 'boxes': 54, 'boxes of paper': 55, 'breakfast bar': 56, 'briefcase': 57, 'broom': 58, 'bucket': 59, 'bulletin board': 60, 'bunk bed': 61, 'cabinet': 62, 'cabinet door': 63, 'cabinet doors': 64, 'cabinets': 65, 'cable': 66, 'calendar': 67, 'camera': 68, 'can': 69, 'candle': 70, 'canopy': 71, 'car': 72, 'card': 73, 'cardboard': 74, 'carpet': 75, 'carseat': 76, 'cart': 77, 'carton': 78, 'case': 79, 'case of water bottles': 80, 'cat litter box': 81, 'cd case': 82, 'ceiling': 83, 'ceiling fan': 84, 'ceiling light': 85, 'chain': 86, 'chair': 87, 'chandelier': 88, 'changing station': 89, 'chest': 90, 'clock': 91, 'closet': 92, 'closet ceiling': 93, 'closet door': 94, 'closet doorframe': 95, 'closet doors': 96, 'closet floor': 97, 'closet rod': 98, 'closet shelf': 99, 'closet wall': 100, 'closet walls': 101, 'cloth': 102, 'clothes': 103, 'clothes dryer': 104, 'clothes dryers': 105, 'clothes hanger': 106, 'clothes hangers': 107, 'clothing': 108, 'clothing rack': 109, 'coat': 110, 'coat rack': 111, 'coatrack': 112, 'coffee box': 113, 'coffee kettle': 114, 'coffee maker': 115, 'coffee table': 116, 'column': 117, 'compost bin': 118, 'computer tower': 119, 'conditioner bottle': 120, 'container': 121, 'controller': 122, 'cooking pan': 123, 'cooking pot': 124, 'copier': 125, 'costume': 126, 'couch': 127, 'couch cushions': 128, 'counter': 129, 'covered box': 130, 'crate': 131, 'crib': 132, 'cup': 133, 'cups': 134, 'curtain': 135, 'curtains': 136, 'cushion': 137, 'cutting board': 138, 'dart board': 139, 'decoration': 140, 'desk': 141, 'desk lamp': 142, 'diaper bin': 143, 'dining table': 144, 'dish rack': 145, 'dishwasher': 146, 'dishwashing soap bottle': 147, 'dispenser': 148, 'display': 149, 'display case': 150, 'display rack': 151, 'divider': 152, 'doll': 153, 'dollhouse': 154, 'dolly': 155, 'door': 156, 'doorframe': 157, 'doors': 158, 'drawer': 159, 'dress rack': 160, 'dresser': 161, 'drum set': 162, 'dryer sheets': 163, 'drying rack': 164, 'duffel bag': 165, 'dumbbell': 166, 'dustpan': 167, 'easel': 168, 'electric panel': 169, 'elevator': 170, 'elevator button': 171, 'elliptical machine': 172, 'end table': 173, 'envelope': 174, 'exercise bike': 175, 'exercise machine': 176, 'exit sign': 177, 'fan': 178, 'faucet': 179, 'file cabinet': 180, 'fire alarm': 181, 'fire extinguisher': 182, 'fireplace': 183, 'flag': 184, 'flip flops': 185, 'floor': 186, 'flower stand': 187, 'flowerpot': 188, 'folded chair': 189, 'folded chairs': 190, 'folded ladder': 191, 'folded table': 192, 'folder': 193, 'food bag': 194, 'food container': 195, 'food display': 196, 'foosball table': 197, 'footrest': 198, 'footstool': 199, 'frame': 200, 'frying pan': 201, 'furnace': 202, 'furniture': 203, 'fuse box': 204, 'futon': 205, 'garage door': 206, 'garbage bag': 207, 'glass doors': 208, 'globe': 209, 'golf bag': 210, 'grab bar': 211, 'grocery bag': 212, 'guitar': 213, 'guitar case': 214, 'hair brush': 215, 'hair dryer': 216, 'hamper': 217, 'hand dryer': 218, 'hand rail': 219, 'hand sanitzer dispenser': 220, 'hand towel': 221, 'handicap bar': 222, 'handrail': 223, 'hanging': 224, 'hat': 225, 'hatrack': 226, 'headboard': 227, 'headphones': 228, 'heater': 229, 'helmet': 230, 'hose': 231, 'hoverboard': 232, 'humidifier': 233, 'ikea bag': 234, 'instrument case': 235, 'ipad': 236, 'iron': 237, 'ironing board': 238, 'jacket': 239, 'jar': 240, 'kettle': 241, 'keyboard': 242, 'keyboard piano': 243, 'kitchen apron': 244, 'kitchen cabinet': 245, 'kitchen cabinets': 246, 'kitchen counter': 247, 'kitchen island': 248, 'kitchenaid mixer': 249, 'knife block': 250, 'ladder': 251, 'lamp': 252, 'lamp base': 253, 'laptop': 254, 'laundry bag': 255, 'laundry basket': 256, 'laundry detergent': 257, 'laundry hamper': 258, 'ledge': 259, 'legs': 260, 'light': 261, 'light switch': 262, 'loft bed': 263, 'loofa': 264, 'luggage': 265, 'luggage rack': 266, 'luggage stand': 267, 'lunch box': 268, 'machine': 269, 'magazine': 270, 'magazine rack': 271, 'mail': 272, 'mail tray': 273, 'mailbox': 274, 'mailboxes': 275, 'map': 276, 'massage chair': 277, 'mat': 278, 'mattress': 279, 'medal': 280, 'messenger bag': 281, 'metronome': 282, 'microwave': 283, 'mini fridge': 284, 'mirror': 285, 'mirror doors': 286, 'monitor': 287, 'mouse': 288, 'mouthwash bottle': 289, 'mug': 290, 'music book': 291, 'music stand': 292, 'nerf gun': 293, 'night lamp': 294, 'nightstand': 295, 'notepad': 296, 'object': 297, 'office chair': 298, 'open kitchen cabinet': 299, 'organizer': 300, 'organizer shelf': 301, 'ottoman': 302, 'oven': 303, 'oven mitt': 304, 'painting': 305, 'pantry shelf': 306, 'pantry wall': 307, 'pantry walls': 308, 'pants': 309, 'paper': 310, 'paper bag': 311, 'paper cutter': 312, 'paper organizer': 313, 'paper towel': 314, 'paper towel dispenser': 315, 'paper towel roll': 316, 'paper tray': 317, 'papers': 318, 'person': 319, 'photo': 320, 'piano': 321, 'piano bench': 322, 'picture': 323, 'pictures': 324, 'pillar': 325, 'pillow': 326, 'pillows': 327, 'ping pong table': 328, 'pipe': 329, 'pipes': 330, 'pitcher': 331, 'pizza boxes': 332, 'plant': 333, 'plastic bin': 334, 'plastic container': 335, 'plastic containers': 336, 'plastic storage bin': 337, 'plate': 338, 'plates': 339, 'plunger': 340, 'podium': 341, 'pool table': 342, 'poster': 343, 'poster cutter': 344, 'poster printer': 345, 'poster tube': 346, 'pot': 347, 'potted plant': 348, 'power outlet': 349, 'power strip': 350, 'printer': 351, 'projector': 352, 'projector screen': 353, 'purse': 354, 'quadcopter': 355, 'rack': 356, 'rack stand': 357, 'radiator': 358, 'rail': 359, 'railing': 360, 'range hood': 361, 'recliner chair': 362, 'recycling bin': 363, 'refrigerator': 364, 'remote': 365, 'rice cooker': 366, 'rod': 367, 'rolled poster': 368, 'roomba': 369, 'rope': 370, 'round table': 371, 'rug': 372, 'salt': 373, 'santa': 374, 'scale': 375, 'scanner': 376, 'screen': 377, 'seat': 378, 'seating': 379, 'sewing machine': 380, 'shampoo': 381, 'shampoo bottle': 382, 'shelf': 383, 'shirt': 384, 'shoe': 385, 'shoe rack': 386, 'shoes': 387, 'shopping bag': 388, 'shorts': 389, 'shower': 390, 'shower control valve': 391, 'shower curtain': 392, 'shower curtain rod': 393, 'shower door': 394, 'shower doors': 395, 'shower floor': 396, 'shower head': 397, 'shower wall': 398, 'shower walls': 399, 'shredder': 400, 'sign': 401, 'sink': 402, 'sliding wood door': 403, 'slippers': 404, 'smoke detector': 405, 'soap': 406, 'soap bottle': 407, 'soap dish': 408, 'soap dispenser': 409, 'sock': 410, 'soda stream': 411, 'sofa bed': 412, 'sofa chair': 413, 'speaker': 414, 'sponge': 415, 'spray bottle': 416, 'stack of chairs': 417, 'stack of cups': 418, 'stack of folded chairs': 419, 'stair': 420, 'stair rail': 421, 'staircase': 422, 'stairs': 423, 'stand': 424, 'stapler': 425, 'starbucks cup': 426, 'statue': 427, 'step': 428, 'step stool': 429, 'sticker': 430, 'stool': 431, 'storage bin': 432, 'storage box': 433, 'storage container': 434, 'storage organizer': 435, 'storage shelf': 436, 'stove': 437, 'structure': 438, 'studio light': 439, 'stuffed animal': 440, 'suitcase': 441, 'suitcases': 442, 'sweater': 443, 'swiffer': 444, 'switch': 445, 'table': 446, 'tank': 447, 'tap': 448, 'tape': 449, 'tea kettle': 450, 'teapot': 451, 'teddy bear': 452, 'telephone': 453, 'telescope': 454, 'thermostat': 455, 'tire': 456, 'tissue box': 457, 'toaster': 458, 'toaster oven': 459, 'toilet': 460, 'toilet brush': 461, 'toilet flush button': 462, 'toilet paper': 463, 'toilet paper dispenser': 464, 'toilet paper holder': 465, 'toilet paper package': 466, 'toilet paper rolls': 467, 'toilet seat cover dispenser': 468, 'toiletry': 469, 'toolbox': 470, 'toothbrush': 471, 'toothpaste': 472, 'towel': 473, 'towel rack': 474, 'towels': 475, 'toy dinosaur': 476, 'toy piano': 477, 'traffic cone': 478, 'trash bag': 479, 'trash bin': 480, 'trash cabinet': 481, 'trash can': 482, 'tray': 483, 'tray rack': 484, 'treadmill': 485, 'tripod': 486, 'trolley': 487, 'trunk': 488, 'tube': 489, 'tupperware': 490, 'tv': 491, 'tv stand': 492, 'umbrella': 493, 'urinal': 494, 'vacuum cleaner': 495, 'vase': 496, 'vending machine': 497, 'vent': 498, 'wall': 499, 'wall hanging': 500, 'wall lamp': 501, 'wall mounted coat rack': 502, 'wardrobe': 503, 'wardrobe cabinet': 504, 'wardrobe closet': 505, 'washcloth': 506, 'washing machine': 507, 'washing machines': 508, 'water bottle': 509, 'water cooler': 510, 'water fountain': 511, 'water heater': 512, 'water pitcher': 513, 'wet floor sign': 514, 'wheel': 515, 'whiteboard': 516, 'whiteboard eraser': 517, 'window': 518, 'windowsill': 519, 'wood': 520, 'wood beam': 521, 'workbench': 522, 'yoga mat': 523}
        elif name == 'sr3d':
            self.type2class = {'air hockey table': 0, 'air mattress': 1, 'airplane': 2, 'alarm': 3, 'alarm clock': 4, 'armchair': 5, 'baby changing station': 6, 'baby mobile': 7, 'backpack': 8, 'bag': 9, 'bag of coffee beans': 10, 'ball': 11, 'banana holder': 12, 'bananas': 13, 'banister': 14, 'banner': 15, 'bar': 16, 'barricade': 17, 'barrier': 18, 'baseball cap': 19, 'basket': 20, 'bath products': 21, 'bath walls': 22, 'bathrobe': 23, 'bathroom cabinet': 24, 'bathroom counter': 25, 'bathroom stall': 26, 'bathroom stall door': 27, 'bathroom vanity': 28, 'bathtub': 29, 'battery disposal jar': 30, 'beachball': 31, 'beanbag chair': 32, 'bear': 33, 'bed': 34, 'bedframe': 35, 'beer bottles': 36, 'bench': 37, 'bicycle': 38, 'bike lock': 39, 'bike pump': 40, 'bin': 41, 'binder': 42, 'binders': 43, 'blackboard': 44, 'blackboard eraser': 45, 'blanket': 46, 'blinds': 47, 'block': 48, 'board': 49, 'boards': 50, 'boat': 51, 'boiler': 52, 'book': 53, 'book rack': 54, 'books': 55, 'bookshelf': 56, 'bookshelves': 57, 'boots': 58, 'bottle': 59, 'bottles': 60, 'bowl': 61, 'box': 62, 'boxes': 63, 'boxes of paper': 64, 'breakfast bar': 65, 'briefcase': 66, 'broom': 67, 'bucket': 68, 'buddha': 69, 'bulletin board': 70, 'bunk bed': 71, 'bycicle': 72, 'cabinet': 73, 'cabinet door': 74, 'cabinet doors': 75, 'cabinets': 76, 'cable': 77, 'calendar': 78, 'camera': 79, 'can': 80, 'candle': 81, 'canopy': 82, 'cap': 83, 'car': 84, 'card': 85, 'cardboard': 86, 'carpet': 87, 'carseat': 88, 'cart': 89, 'carton': 90, 'case': 91, 'case of water bottles': 92, 'cat litter box': 93, 'cd case': 94, 'cd cases': 95, 'ceiling': 96, 'ceiling fan': 97, 'ceiling lamp': 98, 'ceiling light': 99, 'centerpiece': 100, 'chain': 101, 'chair': 102, 'chandelier': 103, 'changing station': 104, 'chest': 105, 'clip': 106, 'clock': 107, 'closet': 108, 'closet ceiling': 109, 'closet door': 110, 'closet doorframe': 111, 'closet doors': 112, 'closet floor': 113, 'closet rod': 114, 'closet shelf': 115, 'closet wall': 116, 'closet walls': 117, 'closet wardrobe': 118, 'cloth': 119, 'clothes': 120, 'clothes dryer': 121, 'clothes dryers': 122, 'clothes hanger': 123, 'clothes hangers': 124, 'clothing': 125, 'clothing rack': 126, 'coat': 127, 'coat rack': 128, 'coatrack': 129, 'coffee bean bag': 130, 'coffee box': 131, 'coffee kettle': 132, 'coffee maker': 133, 'coffee mug': 134, 'coffee table': 135, 'column': 136, 'compost bin': 137, 'computer tower': 138, 'conditioner bottle': 139, 'cone': 140, 'contact lens solution bottle': 141, 'container': 142, 'controller': 143, 'cooking pan': 144, 'cooking pot': 145, 'cooler': 146, 'copier': 147, 'cosmetic bag': 148, 'costume': 149, 'couch': 150, 'couch cushions': 151, 'counter': 152, 'cover': 153, 'covered box': 154, 'crate': 155, 'crib': 156, 'crutches': 157, 'cup': 158, 'cups': 159, 'curtain': 160, 'curtain rod': 161, 'curtains': 162, 'cushion': 163, 'cutting board': 164, 'dart board': 165, 'decoration': 166, 'desk': 167, 'desk lamp': 168, 'diaper bin': 169, 'dining table': 170, 'dish rack': 171, 'dishwasher': 172, 'dishwashing soap bottle': 173, 'dispenser': 174, 'display': 175, 'display case': 176, 'display rack': 177, 'display sign': 178, 'divider': 179, 'doll': 180, 'dollhouse': 181, 'dolly': 182, 'door': 183, 'door wall': 184, 'doorframe': 185, 'doors': 186, 'drawer': 187, 'dress rack': 188, 'dresser': 189, 'drum set': 190, 'dryer sheets': 191, 'drying rack': 192, 'duffel bag': 193, 'dumbbell': 194, 'dumbbell plates': 195, 'dumbell': 196, 'dustpan': 197, 'easel': 198, 'electric panel': 199, 'elevator': 200, 'elevator button': 201, 'elliptical machine': 202, 'end table': 203, 'envelope': 204, 'exercise ball': 205, 'exercise bike': 206, 'exercise machine': 207, 'exit sign': 208, 'fan': 209, 'faucet': 210, 'file cabinet': 211, 'file cabinets': 212, 'file organizer': 213, 'film light': 214, 'fire alarm': 215, 'fire extinguisher': 216, 'fire hose': 217, 'fire sprinkler': 218, 'fireplace': 219, 'fish': 220, 'flag': 221, 'flip flops': 222, 'floor': 223, 'flower stand': 224, 'flowerpot': 225, 'folded boxes': 226, 'folded chair': 227, 'folded chairs': 228, 'folded ladder': 229, 'folded table': 230, 'folder': 231, 'food bag': 232, 'food container': 233, 'food display': 234, 'foosball table': 235, 'footrest': 236, 'footstool': 237, 'frame': 238, 'frying pan': 239, 'furnace': 240, 'furniture': 241, 'fuse box': 242, 'futon': 243, 'gaming wheel': 244, 'garage door': 245, 'garbage bag': 246, 'glass': 247, 'glass doors': 248, 'globe': 249, 'golf bag': 250, 'grab bar': 251, 'grocery bag': 252, 'guitar': 253, 'guitar case': 254, 'hair brush': 255, 'hair dryer': 256, 'hamper': 257, 'hand dryer': 258, 'hand rail': 259, 'hand sanitzer dispenser': 260, 'hand towel': 261, 'handicap bar': 262, 'handrail': 263, 'hanging': 264, 'hat': 265, 'hatrack': 266, 'headboard': 267, 'headphones': 268, 'heater': 269, 'helmet': 270, 'hose': 271, 'hoverboard': 272, 'humidifier': 273, 'ikea bag': 274, 'instrument case': 275, 'ipad': 276, 'iron': 277, 'ironing board': 278, 'jacket': 279, 'jar': 280, 'jewelry box': 281, 'kettle': 282, 'keyboard': 283, 'keyboard piano': 284, 'kinect': 285, 'kitchen apron': 286, 'kitchen cabinet': 287, 'kitchen cabinets': 288, 'kitchen counter': 289, 'kitchen island': 290, 'kitchen mixer': 291, 'kitchenaid mixer': 292, 'knife block': 293, 'ladder': 294, 'lamp': 295, 'lamp base': 296, 'laptop': 297, 'laundry bag': 298, 'laundry basket': 299, 'laundry detergent': 300, 'laundry hamper': 301, 'ledge': 302, 'legs': 303, 'light': 304, 'light switch': 305, 'loft bed': 306, 'loofa': 307, 'lotion': 308, 'lotion bottle': 309, 'luggage': 310, 'luggage rack': 311, 'luggage stand': 312, 'lunch box': 313, 'machine': 314, 'magazine': 315, 'magazine rack': 316, 'mail': 317, 'mail bin': 318, 'mail tray': 319, 'mail trays': 320, 'mailbox': 321, 'mailboxes': 322, 'map': 323, 'massage chair': 324, 'mat': 325, 'mattress': 326, 'medal': 327, 'media center': 328, 'messenger bag': 329, 'metronome': 330, 'microwave': 331, 'mini fridge': 332, 'mirror': 333, 'mirror doors': 334, 'monitor': 335, 'mop': 336, 'mouse': 337, 'mouthwash bottle': 338, 'mug': 339, 'music book': 340, 'music stand': 341, 'nerf gun': 342, 'night lamp': 343, 'night light': 344, 'nightstand': 345, 'notepad': 346, 'object': 347, 'office chair': 348, 'open kitchen cabinet': 349, 'organizer': 350, 'organizer shelf': 351, 'ottoman': 352, 'oven': 353, 'oven mitt': 354, 'painting': 355, 'pantry shelf': 356, 'pantry wall': 357, 'pantry walls': 358, 'pants': 359, 'paper': 360, 'paper bag': 361, 'paper cutter': 362, 'paper organizer': 363, 'paper shredder': 364, 'paper towel': 365, 'paper towel dispenser': 366, 'paper towel roll': 367, 'paper towel rolls': 368, 'paper tray': 369, 'papers': 370, 'pen holder': 371, 'person': 372, 'photo': 373, 'piano': 374, 'piano bench': 375, 'picture': 376, 'pictures': 377, 'pillar': 378, 'pillow': 379, 'pillows': 380, 'ping pong paddle': 381, 'ping pong table': 382, 'pipe': 383, 'pipes': 384, 'pitcher': 385, 'pizza box': 386, 'pizza boxes': 387, 'plant': 388, 'plastic bin': 389, 'plastic container': 390, 'plastic containers': 391, 'plastic storage bin': 392, 'plate': 393, 'plates': 394, 'platform': 395, 'plunger': 396, 'podium': 397, 'pool table': 398, 'postcard': 399, 'poster': 400, 'poster cutter': 401, 'poster printer': 402, 'poster tube': 403, 'pot': 404, 'potted plant': 405, 'power outlet': 406, 'power strip': 407, 'printer': 408, 'projector': 409, 'projector screen': 410, 'purse': 411, 'quadcopter': 412, 'rack': 413, 'rack stand': 414, 'radiator': 415, 'rail': 416, 'railing': 417, 'range hood': 418, 'recliner chair': 419, 'recycling bin': 420, 'refrigerator': 421, 'remote': 422, 'rice cooker': 423, 'rocking chair': 424, 'rod': 425, 'rolled poster': 426, 'roomba': 427, 'rope': 428, 'round table': 429, 'rug': 430, 'salt': 431, 'santa': 432, 'scale': 433, 'scanner': 434, 'screen': 435, 'seat': 436, 'seating': 437, 'sewing machine': 438, 'shampoo': 439, 'shampoo bottle': 440, 'shaving cream': 441, 'shelf': 442, 'shirt': 443, 'shoe': 444, 'shoe rack': 445, 'shoes': 446, 'shopping bag': 447, 'shorts': 448, 'shower': 449, 'shower control valve': 450, 'shower curtain': 451, 'shower curtain rod': 452, 'shower door': 453, 'shower doors': 454, 'shower faucet handle': 455, 'shower floor': 456, 'shower head': 457, 'shower wall': 458, 'shower walls': 459, 'shredder': 460, 'side table': 461, 'sign': 462, 'sink': 463, 'sleeping bag': 464, 'sliding door': 465, 'sliding wood door': 466, 'slipper': 467, 'slippers': 468, 'smoke detector': 469, 'soap': 470, 'soap bar': 471, 'soap bottle': 472, 'soap dish': 473, 'soap dispenser': 474, 'sock': 475, 'socks': 476, 'soda can': 477, 'soda stream': 478, 'sofa': 479, 'sofa bed': 480, 'sofa chair': 481, 'speaker': 482, 'sponge': 483, 'spray bottle': 484, 'stack of chairs': 485, 'stack of cups': 486, 'stack of folded chairs': 487, 'stacks of cups': 488, 'stair': 489, 'stair rail': 490, 'staircase': 491, 'stairs': 492, 'stand': 493, 'stapler': 494, 'star': 495, 'starbucks cup': 496, 'statue': 497, 'step': 498, 'step stool': 499, 'stepladder': 500, 'stepstool': 501, 'stick': 502, 'sticker': 503, 'stool': 504, 'stools': 505, 'storage bin': 506, 'storage box': 507, 'storage container': 508, 'storage organizer': 509, 'storage shelf': 510, 'stove': 511, 'stovetop': 512, 'structure': 513, 'studio light': 514, 'stuffed animal': 515, 'subwoofer': 516, 'suitcase': 517, 'suitcases': 518, 'sweater': 519, 'swiffer': 520, 'switch': 521, 'table': 522, 'table lamp': 523, 'tank': 524, 'tap': 525, 'tape': 526, 'tea kettle': 527, 'teapot': 528, 'teddy bear': 529, 'telephone': 530, 'telescope': 531, 'tennis racket': 532, 'tennis racket bag': 533, 'thermos': 534, 'thermostat': 535, 'tire': 536, 'tissue box': 537, 'toaster': 538, 'toaster oven': 539, 'toilet': 540, 'toilet brush': 541, 'toilet flush button': 542, 'toilet paper': 543, 'toilet paper dispenser': 544, 'toilet paper holder': 545, 'toilet paper package': 546, 'toilet paper rolls': 547, 'toilet seat cover dispenser': 548, 'toiletry': 549, 'toolbox': 550, 'toothbrush': 551, 'toothpaste': 552, 'towel': 553, 'towel rack': 554, 'towels': 555, 'toy dinosaur': 556, 'toy piano': 557, 'traffic cone': 558, 'trash bag': 559, 'trash bin': 560, 'trash cabinet': 561, 'trash can': 562, 'tray': 563, 'tray rack': 564, 'treadmill': 565, 'tripod': 566, 'trolley': 567, 'trunk': 568, 'tube': 569, 'tupperware': 570, 'tv': 571, 'tv stand': 572, 'umbrella': 573, 'urinal': 574, 'vacuum cleaner': 575, 'vase': 576, 'vending machine': 577, 'vent': 578, 'wall': 579, 'wall hanging': 580, 'wall lamp': 581, 'wall mounted coat rack': 582, 'wardrobe': 583, 'wardrobe cabinet': 584, 'wardrobe closet': 585, 'washcloth': 586, 'washing machine': 587, 'washing machines': 588, 'water bottle': 589, 'water cooler': 590, 'water fountain': 591, 'water heater': 592, 'water pitcher': 593, 'water softener': 594, 'wet floor sign': 595, 'wheel': 596, 'whiteboard': 597, 'whiteboard eraser': 598, 'wig': 599, 'window': 600, 'windowsill': 601, 'wood': 602, 'wood beam': 603, 'workbench': 604, 'xbox controller': 605, 'yoga mat': 606}

        self.class2type = {self.type2class[t]: t for t in self.type2class}
